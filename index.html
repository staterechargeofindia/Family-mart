<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ISI â€“ Home</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body style="margin:0;font-family:Arial;background:#f1f3f6">

<!-- ================= SIDE MENU ================= -->
<div id="menu" style="
position:fixed;top:0;left:-260px;width:250px;height:100%;
background:#fff;z-index:9999;padding:15px;
transition:0.3s;box-shadow:2px 0 10px rgba(0,0,0,0.2)">
  <h3>Menu</h3>
  <a href="profile.html">My Profile</a><br><br>
  <a href="my-orders.html">My Orders</a><br><br>
  <a href="cart.html">My Cart</a><br><br>
  <a href="merchant.html">Merchant</a><br><br>
  <a href="admin.html">Admin</a>
</div>

<!-- ================= HEADER ================= -->
<header style="display:flex;align-items:center;justify-content:space-between;
padding:12px;background:#2874f0;color:white">
  <span onclick="toggleMenu()" style="font-size:22px;cursor:pointer">â˜°</span>
  <b>ISI</b>
  <span onclick="location.href='cart.html'" style="font-size:22px;cursor:pointer">
    ðŸ›’ <span id="cartCount">0</span>
  </span>
</header>

<!-- ================= SEARCH ================= -->
<div style="padding:10px;background:#fff">
  <input id="searchInput" onkeyup="searchProducts()"
    placeholder="Search products..."
    style="width:100%;padding:10px;border-radius:8px;border:1px solid #ccc">
</div>

<!-- ================= CATEGORY ================= -->
<div style="padding:10px;background:#fff">
  <button onclick="toggleCategory()"
    style="width:100%;padding:10px;border-radius:8px;
    border:1px solid #ccc;background:#f5f5f5">
    ðŸ“‚ Category
  </button>

  <div id="categoryBox" style="display:none;margin-top:8px;
  border:1px solid #ddd;border-radius:8px;background:#fff"></div>
</div>

<!-- ================= PRODUCTS ================= -->
<div id="productList"></div>

<script>
/* MENU */
function toggleMenu(){
  const m=document.getElementById("menu");
  m.style.left=m.style.left==="0px"?"-260px":"0px";
}

/* CART COUNT */
function updateCartCount(){
  const cart=JSON.parse(localStorage.getItem("cart"))||[];
  document.getElementById("cartCount").innerText=cart.length;
}
updateCartCount();

/* LOAD PRODUCTS */
const products=JSON.parse(localStorage.getItem("products"))||[];
const box=document.getElementById("productList");

/* LOAD CATEGORIES (ADMIN CONTROLLED) */
const categories=JSON.parse(localStorage.getItem("categories"))||[];
const catBox=document.getElementById("categoryBox");

catBox.innerHTML=`<div class="cat" onclick="filterCategory('all')">All Products</div>`;
categories.forEach(c=>{
  catBox.innerHTML+=`
    <div class="cat" onclick="filterCategory('${c}')">
      ${c.charAt(0).toUpperCase()+c.slice(1)}
    </div>`;
});

/* RENDER PRODUCTS */
if(products.length===0){
  box.innerHTML="<div class='card'>No products available</div>";
}

products.forEach((p,i)=>{
  box.innerHTML+=`
  <div class="card-product" data-category="${p.category}">
    <div class="slider">
      <img src="${p.images[0]}" class="slide active" id="i1-${i}"
        onclick="zoomImage('${p.images[0]}')">
      <img src="${p.images[1]}" class="slide" id="i2-${i}"
        onclick="zoomImage('${p.images[1]}')">

      <span class="nav left" onclick="toggleImg(${i})">â€¹</span>
      <span class="nav right" onclick="toggleImg(${i})">â€º</span>

      <div class="dots">
        <span class="dot active" id="d1-${i}"></span>
        <span class="dot" id="d2-${i}"></span>
      </div>
    </div>

    <b>${p.name}</b>
    <p class="desc">${p.desc}</p>

    <div>
      <b>â‚¹${p.price}</b>
      <del>â‚¹${p.mrp}</del>
      <span class="off">${p.discount}% OFF</span>
    </div>

    <button onclick="addToCart('${p.name}',${p.price},'${p.merchant}')">
      Add to Cart
    </button>
  </div>`;
});

/* SLIDER + DOTS */
function toggleImg(i){
  const a=document.getElementById(`i1-${i}`);
  const b=document.getElementById(`i2-${i}`);
  const d1=document.getElementById(`d1-${i}`);
  const d2=document.getElementById(`d2-${i}`);
  const show=!a.classList.contains("active");
  a.classList.toggle("active",show);
  b.classList.toggle("active",!show);
  d1.classList.toggle("active",show);
  d2.classList.toggle("active",!show);
}

/* SEARCH */
function searchProducts(){
  const k=searchInput.value.toLowerCase();
  document.querySelectorAll(".card-product").forEach(c=>{
    c.style.display=c.innerText.toLowerCase().includes(k)?"block":"none";
  });
}

/* CATEGORY FILTER */
function toggleCategory(){
  categoryBox.style.display=
    categoryBox.style.display==="block"?"none":"block";
}
function filterCategory(cat){
  document.querySelectorAll(".card-product").forEach(c=>{
    c.style.display=(cat==="all"||c.dataset.category===cat)?"block":"none";
  });
  categoryBox.style.display="none";
}

/* CART */
function addToCart(n,p,m){
  const c=JSON.parse(localStorage.getItem("cart"))||[];
  c.push({name:n,price:p,merchant:m});
  localStorage.setItem("cart",JSON.stringify(c));
  updateCartCount();
  alert("Added to cart");
}

/* ZOOM */
function zoomImage(src){
  const o=document.createElement("div");
  o.style=`position:fixed;top:0;left:0;width:100%;height:100%;
  background:rgba(0,0,0,0.9);display:flex;
  align-items:center;justify-content:center;z-index:10000`;
  o.innerHTML=`<img src="${src}" style="max-width:95%;max-height:95%">`;
  o.onclick=()=>document.body.removeChild(o);
  document.body.appendChild(o);
}
</script>

<style>
#productList{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:12px;
  padding:10px;
}
.card-product{
  background:#fff;
  padding:8px;
  border-radius:10px;
}
.slider{
  position:relative;
  height:140px;
  overflow:hidden;
  border-radius:8px;
}
.slide{
  position:absolute;
  width:100%;
  height:140px;
  object-fit:cover;
  display:none;
}
.slide.active{display:block}
.nav{
  position:absolute;top:50%;transform:translateY(-50%);
  background:rgba(0,0,0,0.5);color:white;
  padding:4px 8px;border-radius:50%;
}
.nav.left{left:6px}
.nav.right{right:6px}
.dots{
  text-align:center;position:absolute;bottom:4px;width:100%;
}
.dot{
  height:6px;width:6px;background:#ccc;border-radius:50%;
  display:inline-block;margin:0 2px;
}
.dot.active{background:#fff}
button{
  width:100%;padding:8px;margin-top:6px;
  background:#2874f0;color:white;border:none;border-radius:6px;
}
.desc{font-size:12px;color:#555}
.off{color:green;font-size:12px}
.cat{
  padding:10px;border-bottom:1px solid #eee;cursor:pointer;
}
.cat:hover{background:#f1f1f1}
.card{
  background:#fff;padding:15px;border-radius:10px;margin:10px;
}
</style>

</body>
</html>
