<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ISI â€“ Home</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="css/style.css">
</head>

<body>

<!-- ================= SIDE MENU ================= -->
<div id="menu" class="side-menu">
  <a href="profile.html">My Profile</a>
  <a href="cart.html">My Cart</a>
  <a href="merchant.html">Merchant</a>
  <a href="admin.html">Admin</a>
</div>

<!-- ================= HEADER (HOME SPECIAL) ================= -->
<header style="display:flex;align-items:center;justify-content:space-between;
padding:12px;background:#2874f0;color:white">

  <!-- MENU -->
  <span id="menuBtn" style="font-size:22px;cursor:pointer">â˜°</span>

  <!-- TITLE -->
  <b>ISI</b>

  <!-- CART -->
  <span onclick="location.href='cart.html'" style="font-size:22px;cursor:pointer">
    ðŸ›’ <span id="cartCount">0</span>
  </span>

</header>

<!-- ================= PRODUCTS ================= -->
<div class="products" id="productList"></div>

<!-- ================= JS ================= -->
<script src="js/main.js"></script>
<script src="js/cart.js"></script>

<script>
const products = JSON.parse(localStorage.getItem("products")) || [];
const box = document.getElementById("productList");

/* NO PRODUCTS */
if(products.length === 0){
  box.innerHTML = `
    <div class="card">
      No products available.<br>
      Merchant please publish products.
    </div>
  `;
}

/* SHOW PRODUCTS */
products.forEach((p, index) => {
  box.innerHTML += `
    <div class="card-product">

      <!-- IMAGE SLIDER -->
      <div class="slider" id="slider-${index}">
        <img src="${p.images[0]}" class="slide active"
             onclick="zoomImage('${p.images[0]}')">
        <img src="${p.images[1]}" class="slide"
             onclick="zoomImage('${p.images[1]}')">
      </div>

      <b>${p.name}</b>

      <p style="font-size:13px;color:#555">
        ${p.desc}
      </p>

      <div class="price">
        â‚¹${p.price}
        <del style="color:#888">â‚¹${p.mrp}</del>
        <span style="color:green;font-size:13px">
          ${p.discount}% OFF
        </span>
      </div>

      <button onclick="addToCart('${p.name}', ${p.price}, '${p.merchant}')">
        Add to Cart
      </button>

      <small style="display:block;margin-top:6px">
        Sold by ${p.merchant}
      </small>

    </div>
  `;
});

/* CART COUNT */
if(typeof updateCartCount === "function"){
  updateCartCount();
}

/* IMAGE SLIDER AUTO */
document.querySelectorAll(".slider").forEach(slider=>{
  let i = 0;
  const slides = slider.querySelectorAll(".slide");
  setInterval(()=>{
    slides[i].classList.remove("active");
    i = (i + 1) % slides.length;
    slides[i].classList.add("active");
  }, 3000);
});

/* IMAGE ZOOM */
function zoomImage(src){
  const overlay = document.createElement("div");
  overlay.style = `
    position:fixed;
    top:0;left:0;
    width:100%;height:100%;
    background:rgba(0,0,0,0.9);
    display:flex;
    align-items:center;
    justify-content:center;
    z-index:9999;
  `;
  overlay.innerHTML = `
    <img src="${src}" style="max-width:95%;max-height:95%">
  `;
  overlay.onclick = () => document.body.removeChild(overlay);
  document.body.appendChild(overlay);
}
</script>

<style>
.slider{
  position:relative;
  height:160px;
  overflow:hidden;
}
.slide{
  position:absolute;
  width:100%;
  height:160px;
  object-fit:cover;
  display:none;
}
.slide.active{
  display:block;
}
</style>

</body>
</html>
