<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ISI ‚Äì Publish Product</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="css/style.css">
</head>

<body>

<!-- ================= HEADER ================= -->
<header style="display:flex;align-items:center;justify-content:space-between;
padding:12px;background:#2874f0;color:white">

  <span onclick="history.back()" style="font-size:22px;cursor:pointer">‚¨ÖÔ∏è</span>
  <b>Publish Product</b>
  <span onclick="location.href='index.html'" style="font-size:22px;cursor:pointer">üè†</span>

</header>

<!-- ================= FORM ================= -->
<div class="container">

  <div class="card">
    <h3>Product Details</h3>

    <input id="pname" placeholder="Product Name">
    <textarea id="pdesc" placeholder="Product Description"></textarea>

    <input id="mrp" type="number" placeholder="Original Price (MRP)">
    <input id="price" type="number" placeholder="Selling Price">

    <p style="font-size:13px;color:#555">
      Discount: <b><span id="discountText">0</span>% OFF</b>
    </p>

    <label>Product Image 1</label>
    <input type="file" id="img1" accept="image/*">

    <label>Product Image 2</label>
    <input type="file" id="img2" accept="image/*">

    <button onclick="publishProduct()">Publish Product</button>
  </div>

</div>

<!-- ================= SCRIPT ================= -->
<script>
const merchant = JSON.parse(localStorage.getItem("merchant"));
if(!merchant){
  alert("Merchant not logged in");
  location.href = "merchant.html";
}

let image1 = "";
let image2 = "";

/* LOAD IMAGE */
function loadImage(input, callback){
  if(!input.files[0]) return;
  const reader = new FileReader();
  reader.onload = () => callback(reader.result);
  reader.readAsDataURL(input.files[0]);
}

img1.onchange = () => loadImage(img1, data => image1 = data);
img2.onchange = () => loadImage(img2, data => image2 = data);

/* AUTO DISCOUNT */
mrp.oninput = price.oninput = () => {
  const m = Number(mrp.value);
  const s = Number(price.value);
  if(m > 0 && s > 0 && s <= m){
    discountText.innerText = Math.round(((m - s) / m) * 100);
  } else {
    discountText.innerText = 0;
  }
};

/* PUBLISH */
function publishProduct(){

  if(!pname.value || !pdesc.value){
    alert("Please fill product name and description");
    return;
  }

  if(!image1 || !image2){
    alert("Please select at least 2 images");
    return;
  }

  const m = Number(mrp.value);
  const s = Number(price.value);

  if(!m || !s || s > m){
    alert("Check price details");
    return;
  }

  const discount = Math.round(((m - s) / m) * 100);

  const product = {
    id: Date.now(),
    name: pname.value,
    desc: pdesc.value,
    mrp: m,
    price: s,
    discount: discount,
    images: [image1, image2],
    merchant: merchant.shopName
  };

  const products = JSON.parse(localStorage.getItem("products")) || [];
  products.push(product);
  localStorage.setItem("products", JSON.stringify(products));

  alert("Product published successfully");
  location.href = "merchant-dashboard.html";
}
</script>

</body>
</html>
