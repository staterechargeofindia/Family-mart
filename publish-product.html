<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Publish Product</title>

<style>
body{margin:0;background:#f4f6f8;font-family:Arial}
header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:12px;
  background:#1b3c8b;
  color:#fff;
}
.container{
  padding:12px;
}
.card{
  background:#fff;
  border-radius:14px;
  padding:12px;
}
input,textarea,select{
  width:100%;
  padding:10px;
  margin-bottom:10px;
  border-radius:8px;
  border:1px solid #ccc;
}
button{
  width:100%;
  padding:12px;
  background:#2874f0;
  color:#fff;
  border:none;
  border-radius:10px;
  font-size:16px;
}
small{color:#666}
</style>
</head>

<body>

<header>
  <span onclick="history.back()" style="cursor:pointer">‚¨Ö</span>
  <b>Publish Product</b>
  <span onclick="location.href='index.html'" style="cursor:pointer">üè†</span>
</header>

<div class="container">
  <div class="card">

    <!-- CATEGORY -->
    <select id="category">
      <option value="">Select Category</option>
    </select>

    <!-- PHONE TYPE -->
    <select id="phoneType">
      <option value="">Phone Type (optional)</option>
      <option value="new">New Phone</option>
      <option value="old">Old Phone</option>
    </select>

    <!-- BRAND -->
    <select id="brand">
      <option value="">Select Brand (optional)</option>
      <option>Samsung</option>
      <option>Vivo</option>
      <option>Oppo</option>
      <option>Realme</option>
      <option>Xiaomi</option>
      <option>Apple</option>
      <option>Motorola</option>
      <option>OnePlus</option>
    </select>

    <!-- MODEL -->
    <input id="model" placeholder="Model Name (optional)">

    <!-- PRODUCT DETAILS -->
    <input id="name" placeholder="Product Name">
    <textarea id="desc" placeholder="Product Description"></textarea>

    <input id="mrp" type="number" placeholder="Original Price (MRP)">
    <input id="price" type="number" placeholder="Selling Price" oninput="calcDiscount()">

    <p><b>Discount:</b> <span id="discount">0%</span></p>

    <!-- IMAGES -->
    <small>Upload up to 4 images (minimum 1)</small>
    <input type="file" id="img1" accept="image/*">
    <input type="file" id="img2" accept="image/*">
    <input type="file" id="img3" accept="image/*">
    <input type="file" id="img4" accept="image/*">

    <button onclick="publish()">Publish Product</button>
  </div>
</div>

<script>
const categories = JSON.parse(localStorage.getItem("categories")) || [];
const merchant = JSON.parse(localStorage.getItem("merchant")) || {};

categories.forEach(c=>{
  category.innerHTML += `<option value="${c.id}">${c.name}</option>`;
});

function calcDiscount(){
  const mrp = Number(document.getElementById("mrp").value);
  const price = Number(document.getElementById("price").value);
  if(mrp && price && mrp>price){
    const d = Math.round(((mrp-price)/mrp)*100);
    discount.innerText = d + "%";
  }else{
    discount.innerText = "0%";
  }
}

function getBase64(file){
  return new Promise(res=>{
    if(!file) return res(null);
    const r = new FileReader();
    r.onload=()=>res(r.result);
    r.readAsDataURL(file);
  });
}

async function publish(){
  const images=[];
  const f1=img1.files[0], f2=img2.files[0], f3=img3.files[0], f4=img4.files[0];
  if(!f1){
    alert("Please upload at least 1 image");
    return;
  }

  for(const f of [f1,f2,f3,f4]){
    if(f) images.push(await getBase64(f));
  }

  const product={
    id:Date.now(),
    name:name.value || "No name",
    desc:desc.value || "",
    category:category.value || "other",
    phoneType:phoneType.value || "",
    brand:brand.value.toLowerCase() || "",
    model:model.value || "",
    mrp:Number(mrp.value)||0,
    price:Number(price.value)||0,
    images,
    merchantShop:merchant.shop || "Unknown Shop"
  };

  const list = JSON.parse(localStorage.getItem("products")) || [];
  list.push(product);
  localStorage.setItem("products",JSON.stringify(list));

  alert("‚úÖ Product Published Successfully");
  location.href="merchant-dashboard.html";
}
</script>

</body>
</html>
