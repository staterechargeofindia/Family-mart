<!DOCTYPE html>
<html>
<head>
  <title>Publish Product</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="css/style.css">
</head>
<body>

<header>Publish Product</header>

<div class="container card">
  <input id="pname" placeholder="Product Name">
  <textarea id="desc" placeholder="Product Description"></textarea>

  <input id="mrp" placeholder="Original Price (MRP)">
  <input id="price" placeholder="Selling Price">

  <label>Product Image 1</label>
  <input type="file" id="img1" accept="image/*">

  <label>Product Image 2</label>
  <input type="file" id="img2" accept="image/*">

  <button onclick="publish()">Publish</button>
</div>

<script>
const merchant = JSON.parse(localStorage.getItem("merchant"));
let imgData1 = "", imgData2 = "";

function loadImage(input, cb){
  if(!input.files[0]) return;
  const r = new FileReader();
  r.onload = ()=>cb(r.result);
  r.readAsDataURL(input.files[0]);
}

img1.onchange = ()=>loadImage(img1, d=>imgData1=d);
img2.onchange = ()=>loadImage(img2, d=>imgData2=d);

function publish(){
  const MRP = Number(mrp.value);
  const SELL = Number(price.value);
  const discount = MRP > 0 ? Math.round(((MRP - SELL)/MRP)*100) : 0;

  const product = {
    id: Date.now(),
    name: pname.value,
    desc: desc.value,
    mrp: MRP,
    price: SELL,
    discount: discount,
    images: [
      imgData1 || "assets/placeholder.png",
      imgData2 || "assets/placeholder.png"
    ],
    merchant: merchant.shopName
  };

  const products = JSON.parse(localStorage.getItem("products")) || [];
  products.push(product);
  localStorage.setItem("products", JSON.stringify(products));

  alert("Product Published");
  location.href="merchant-dashboard.html";
}
</script>

</body>
</html>
