<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Publish Product</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{margin:0;font-family:Arial,Helvetica,sans-serif;background:#f1f3f6}
header{
  background:#2874f0;color:#fff;padding:12px;
  display:flex;justify-content:space-between;align-items:center
}
header b{font-size:18px}
.container{padding:15px}
.card{background:#fff;padding:15px;border-radius:14px}
input,select,textarea{
  width:100%;padding:10px;margin-bottom:12px;
  border-radius:8px;border:1px solid #ccc
}
button{
  width:100%;padding:12px;background:#2874f0;
  color:white;border:none;border-radius:10px;font-size:16px
}
small{color:#555}
.note{font-size:12px;color:#777;margin-bottom:10px}
</style>
</head>

<body>

<header>
  <span onclick="history.back()" style="cursor:pointer">‚¨Ö</span>
  <b>Publish Product</b>
  <span onclick="location.href='index.html'" style="cursor:pointer">üè†</span>
</header>

<div class="container">
<div class="card">

<!-- CATEGORY (FIXED) -->
<select id="category">
  <option value="">Select Category</option>
</select>

<!-- PHONE TYPE -->
<select id="phoneType">
  <option value="">Select Phone Type</option>
  <option value="new">New Phone</option>
  <option value="old">Old Phone</option>
</select>

<!-- BRAND -->
<select id="brand">
  <option value="">Select Brand</option>
  <option value="samsung">Samsung</option>
  <option value="vivo">Vivo</option>
  <option value="oppo">Oppo</option>
  <option value="xiaomi">Xiaomi</option>
  <option value="realme">Realme</option>
  <option value="oneplus">OnePlus</option>
  <option value="apple">Apple (iPhone)</option>
  <option value="motorola">Motorola</option>
</select>

<!-- PRODUCT INFO -->
<input id="name" placeholder="Product Name">
<input id="model" placeholder="Model Name">
<textarea id="desc" placeholder="Product Description"></textarea>

<!-- PRICE -->
<input id="mrp" type="number" placeholder="MRP">
<input id="price" type="number" placeholder="Selling Price" onkeyup="calcDiscount()">
<small id="discountText"></small>

<!-- IMAGES -->
<div class="note">Upload up to 4 images (minimum 1 required)</div>
<input type="file" id="img1" accept="image/*">
<input type="file" id="img2" accept="image/*">
<input type="file" id="img3" accept="image/*">
<input type="file" id="img4" accept="image/*">

<button onclick="publish()">Publish Product</button>

</div>
</div>

<script>
/* ===== LOAD CATEGORIES (INDEX / ADMIN SAME SOURCE) ===== */
const categorySelect = document.getElementById("category");
const categories = JSON.parse(localStorage.getItem("categories")) || [];

categories.forEach(c=>{
  // SAFETY CHECK (object format)
  if(c.id && c.name){
    const opt = document.createElement("option");
    opt.value = c.id;     // system use
    opt.textContent = c.name; // display name
    categorySelect.appendChild(opt);
  }
});

/* ===== DISCOUNT ===== */
function calcDiscount(){
  const m=+mrp.value;
  const p=+price.value;
  if(m>0 && p>0){
    discountText.innerText =
      "Discount: " + Math.round(((m-p)/m)*100) + "%";
  }else{
    discountText.innerText="";
  }
}

/* ===== IMAGE TO BASE64 ===== */
function toBase64(file){
  return new Promise(res=>{
    const r=new FileReader();
    r.onload=()=>res(r.result);
    r.readAsDataURL(file);
  });
}

/* ===== PUBLISH PRODUCT ===== */
async function publish(){
  if(!category.value || !name.value || !price.value || !mrp.value){
    alert("Please fill required fields");
    return;
  }

  const products = JSON.parse(localStorage.getItem("products")) || [];
  const images = [];

  if(img1.files[0]) images.push(await toBase64(img1.files[0]));
  if(img2.files[0]) images.push(await toBase64(img2.files[0]));
  if(img3.files[0]) images.push(await toBase64(img3.files[0]));
  if(img4.files[0]) images.push(await toBase64(img4.files[0]));

  if(images.length === 0){
    alert("Please upload at least one image");
    return;
  }

  const product = {
    id: Date.now(),
    category: category.value,
    phoneType: phoneType.value,
    brand: brand.value,
    name: name.value,
    model: model.value,
    description: desc.value,
    mrp: +mrp.value,
    price: +price.value,
    images: images,
    merchant: localStorage.getItem("merchantName") || "Merchant"
  };

  products.push(product);
  localStorage.setItem("products", JSON.stringify(products));

  alert("Product published successfully");
  location.href = "merchant-dashboard.html";
}
</script>

</body>
</html>
