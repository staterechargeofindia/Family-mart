<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Publish Product ‚Äì Merchant</title>

<style>
*{box-sizing:border-box;font-family:Arial,Helvetica,sans-serif}
body{margin:0;background:#f5f6f8}

/* HEADER */
header{
  background:#2874f0;color:#fff;
  padding:12px;
  display:flex;align-items:center;justify-content:space-between;
}
header span{font-size:20px;cursor:pointer}

/* FORM */
.container{padding:12px}
.card{
  background:#fff;border-radius:14px;padding:15px;
  box-shadow:0 2px 6px rgba(0,0,0,0.1);
  margin-bottom:12px;
}
.card h2{margin-top:0}

/* INPUT */
input,textarea,select{
  width:100%;padding:12px;margin-bottom:10px;
  border-radius:10px;border:1px solid #ccc;font-size:15px;
}
textarea{resize:none;height:70px}

/* BUTTON */
button{
  width:100%;padding:14px;
  background:#2874f0;color:#fff;
  border:none;border-radius:12px;
  font-size:16px;cursor:pointer;
}

/* PRODUCT LIST */
.product{
  border:1px solid #ddd;
  border-radius:10px;
  padding:10px;
  margin-bottom:10px;
}
.product img{
  width:100%;max-height:150px;
  object-fit:cover;border-radius:8px;
}
.del{
  background:#e53935;margin-top:8px;
}
</style>
</head>

<body>

<header>
  <span onclick="history.back()">‚Üê</span>
  <b>Publish Product</b>
  <span onclick="location.href='merchant-dashboard.html'">üè™</span>
</header>

<div class="container">

  <!-- ADD PRODUCT -->
  <div class="card">
    <h2>Add New Product</h2>

    <input id="pname" placeholder="Product Name">
    <textarea id="pdesc" placeholder="Product Description"></textarea>

    <select id="pcat">
      <option value="">Select Category</option>
      <option>Fashion</option>
      <option>Beauty</option>
      <option>Electronics</option>
      <option>Kids</option>
      <option>Home</option>
      <option>Top Deals</option>
      <option>New Phone</option>
      <option>Old Phone</option>
      <option>Cover</option>
      <option>Grocery</option>
      <option>Vegetable</option>
      <option>Fruits</option>
      <option>Cooked</option>
      <option>Meat</option>
      <option>Mithai</option>
      <option>Biryani</option>
    </select>

    <input id="pmrp" type="number" placeholder="MRP">
    <input id="pprice" type="number" placeholder="Selling Price">

    <input id="pimg" type="file" multiple accept="image/*">

    <button onclick="publish()">Publish Product</button>
  </div>

  <!-- MY PRODUCTS -->
  <div class="card">
    <h2>My Products</h2>
    <div id="myProducts"></div>
  </div>

</div>

<script>
/* SESSION */
const merchantShop = localStorage.getItem("merchantShop");
if(!merchantShop){
  alert("Merchant not logged in");
  location.href="merchant-login.html";
}

/* DATA */
let products = JSON.parse(localStorage.getItem("products")) || [];

/* PUBLISH */
function publish(){
  const name=pname.value.trim();
  const desc=pdesc.value.trim();
  const cat=pcat.value;
  const mrp=Number(pmrp.value);
  const price=Number(pprice.value);
  const files=pimg.files;

  if(!name || !cat || !price || files.length===0){
    alert("Fill product details & add image");
    return;
  }

  const images=[];
  let loaded=0;

  for(let f of files){
    const r=new FileReader();
    r.onload=e=>{
      images.push(e.target.result);
      loaded++;
      if(loaded===files.length) saveProduct(images);
    };
    r.readAsDataURL(f);
  }
}

function saveProduct(images){
  const mrp=Number(pmrp.value)||Number(pprice.value);
  const price=Number(pprice.value);
  const discount=Math.round(((mrp-price)/mrp)*100);

  const product={
    id:Date.now(),
    name:pname.value,
    description:pdesc.value,
    category:pcat.value,
    mrp,price,discount,
    images,
    merchantShop
  };

  products.push(product);
  localStorage.setItem("products",JSON.stringify(products));
  clearForm();
  renderMyProducts();
}

function clearForm(){
  pname.value="";
  pdesc.value="";
  pcat.value="";
  pmrp.value="";
  pprice.value="";
  pimg.value="";
}

/* MY PRODUCTS LIST */
function renderMyProducts(){
  const box=document.getElementById("myProducts");
  box.innerHTML="";
  const mine=products.filter(p=>p.merchantShop===merchantShop);

  if(mine.length===0){
    box.innerHTML="<p>No products added yet</p>";
    return;
  }

  mine.forEach(p=>{
    const d=document.createElement("div");
    d.className="product";
    d.innerHTML=`
      <img src="${p.images[0]}">
      <b>${p.name}</b><br>
      ‚Çπ${p.price} <del>‚Çπ${p.mrp}</del> (${p.discount}% OFF)
      <button class="del" onclick="deleteProduct(${p.id})">Delete</button>
    `;
    box.appendChild(d);
  });
}

/* DELETE */
function deleteProduct(id){
  if(!confirm("Delete this product?"))return;
  products=products.filter(p=>p.id!==id);
  localStorage.setItem("products",JSON.stringify(products));
  renderMyProducts();
}

renderMyProducts();
</script>

</body>
</html>
