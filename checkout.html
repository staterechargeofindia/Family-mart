<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Checkout</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body style="margin:0;font-family:Arial;background:#f1f3f6">

<!-- ================= HEADER ================= -->
<header style="display:flex;align-items:center;justify-content:space-between;
padding:12px;background:#2874f0;color:white">
  <span onclick="history.back()" style="font-size:22px;cursor:pointer">‚¨ÖÔ∏è</span>
  <b>Checkout</b>
  <span onclick="location.href='index.html'" style="font-size:22px;cursor:pointer">üè†</span>
</header>

<div style="padding:10px">

<!-- ================= ADDRESS ================= -->
<div class="card">
  <h3>Delivery Address</h3>
  <div id="addressBox"></div>
  <button onclick="location.href='profile.html'"
    style="background:#eee;color:#000">Edit Address</button>
</div>

<!-- ================= PAYMENT ================= -->
<div class="card">
  <h3>Payment Method</h3>
  <button onclick="selectPay('COD')">Cash on Delivery</button>
  <button onclick="selectPay('UPI')">UPI (QR / App)</button>
</div>

<!-- ================= PAYMENT DETAILS ================= -->
<div class="card" id="payBox" style="display:none"></div>

<button onclick="placeOrder()">Confirm Order</button>

</div>

<!-- ================= SUCCESS POPUP ================= -->
<div id="successPopup" style="
display:none;position:fixed;top:0;left:0;width:100%;height:100%;
background:rgba(0,0,0,0.6);z-index:9999;
align-items:center;justify-content:center">

  <div style="background:white;padding:25px;border-radius:16px;
  text-align:center;width:80%;max-width:300px;animation:pop .4s ease">
    <div style="font-size:42px">üéÅ</div>
    <h2 style="color:#2e7d32">Order Successful!</h2>
    <p>Amazing üéâ<br>Your order has been placed</p>
  </div>

  <div id="confetti"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>

<script>
const profile = JSON.parse(localStorage.getItem("profile")) || {};
const cart = JSON.parse(localStorage.getItem("cart")) || [];
let orders = JSON.parse(localStorage.getItem("orders")) || [];
const UPI_ID = "paytmgr5m9yhroptys";
let payment = "COD";

/* ADDRESS */
addressBox.innerHTML = `
<b>${profile.name || ""}</b><br>
${profile.mobile || ""}<br>
${profile.address || ""}<br>
${profile.district || ""}, ${profile.state || ""} - ${profile.pincode || ""}
`;

/* TOTAL */
const total = cart.reduce((s,i)=>s+Number(i.price),0);

/* PAYMENT SELECT */
function selectPay(type){
  payment = type;
  payBox.style.display = "block";
  payBox.innerHTML = "";

  if(type==="COD"){
    payBox.innerHTML="<p>Pay cash at delivery.</p>";
  }

  if(type==="UPI"){
    const upi = `upi://pay?pa=${UPI_ID}&pn=ISI&am=${total}&cu=INR`;
    payBox.innerHTML = `
      <p><b>Total:</b> ‚Çπ${total}</p>
      <p><b>UPI ID:</b> ${UPI_ID}</p>
      <div id="qrcode"></div>
      <a href="${upi}">
        <button>Pay via PhonePe / GPay / Paytm</button>
      </a>
      <p style="font-size:12px">After payment, click Confirm Order</p>
    `;
    new QRCode(document.getElementById("qrcode"),{
      text:upi,width:180,height:180
    });
  }
}

/* PLACE ORDER */
function placeOrder(){
  if(cart.length===0){
    alert("Cart empty");
    return;
  }

  orders.push({
    id:"ORD-"+Date.now(),
    customer:profile,
    items:cart,
    amount:total,
    payment:payment,
    status:"New",
    created:new Date().toLocaleString()
  });

  localStorage.setItem("orders",JSON.stringify(orders));
  localStorage.removeItem("cart");

  showSuccess();
}

/* SUCCESS POPUP */
function showSuccess(){
  successPopup.style.display="flex";
  confetti.innerHTML="";
  for(let i=0;i<40;i++){
    const p=document.createElement("div");
    p.innerText="üéä";
    p.style=`position:fixed;left:${Math.random()*100}vw;
    top:-20px;font-size:20px;animation:fall ${2+Math.random()*2}s linear`;
    confetti.appendChild(p);
  }
  setTimeout(()=>{
    successPopup.style.display="none";
    location.href="index.html";
  },2500);
}
</script>

<style>
.card{background:#fff;padding:15px;margin-bottom:15px;border-radius:10px}
button{width:100%;padding:10px;margin-top:8px;
background:#2874f0;color:white;border:none;border-radius:6px}
@keyframes fall{to{transform:translateY(110vh);opacity:0}}
@keyframes pop{from{transform:scale(.6);opacity:0}to{transform:scale(1)}}
</style>

</body>
</html>
