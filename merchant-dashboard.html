<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Merchant Dashboard</title>

<style>
*{box-sizing:border-box;font-family:Arial}
body{margin:0;background:#f4f6f8}

/* HEADER */
header{
  background:#1b3c8b;
  color:#fff;
  padding:12px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
header b{font-size:18px}
header span{cursor:pointer}

/* TABS */
.tabs{
  display:flex;
  background:#fff;
}
.tab{
  flex:1;
  text-align:center;
  padding:12px;
  cursor:pointer;
  font-weight:bold;
}
.tab.active{
  border-bottom:3px solid #2874f0;
  color:#2874f0;
}

/* CONTENT */
.container{padding:12px}
.products{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:12px;
}
.card{
  background:#fff;
  border-radius:14px;
  overflow:hidden;
}
.card img{
  width:100%;
  height:150px;
  object-fit:cover;
}
.card-body{padding:10px}
.price{font-weight:bold}
.btn{
  width:100%;
  padding:8px;
  margin-top:6px;
  border:none;
  border-radius:8px;
  cursor:pointer;
}
.delete{background:#e53935;color:#fff}
.order{
  background:#fff;
  border-radius:14px;
  padding:10px;
  margin-bottom:10px;
}
.grey{opacity:.6}
.empty{text-align:center;padding:30px;color:#666}
</style>
</head>

<body>

<header>
  <span onclick="location.href='index.html'">üè†</span>
  <b>Merchant Dashboard</b>
  <span onclick="location.href='publish-product.html'">‚ûï</span>
</header>

<!-- TABS -->
<div class="tabs">
  <div class="tab active" onclick="showTab('products')">My Products</div>
  <div class="tab" onclick="showTab('orders')">My Orders</div>
</div>

<div class="container">

<!-- MY PRODUCTS -->
<div id="productsTab">
  <div class="products" id="productList"></div>
</div>

<!-- MY ORDERS -->
<div id="ordersTab" style="display:none">
  <div id="orderList"></div>
</div>

</div>

<script>
/* ===== LOGIN CHECK ===== */
const merchantName = localStorage.getItem("merchantName");
if(!merchantName){
  location.href="merchant-login.html";
}

/* DATA */
let products = JSON.parse(localStorage.getItem("products")) || [];
let orders = JSON.parse(localStorage.getItem("orders")) || [];

/* TAB SWITCH */
function showTab(t){
  document.querySelectorAll(".tab").forEach(e=>e.classList.remove("active"));
  if(t==="products"){
    productsTab.style.display="block";
    ordersTab.style.display="none";
    document.querySelectorAll(".tab")[0].classList.add("active");
  }else{
    productsTab.style.display="none";
    ordersTab.style.display="block";
    document.querySelectorAll(".tab")[1].classList.add("active");
  }
}

/* ===== MY PRODUCTS ===== */
function renderProducts(){
  const box = productList;
  box.innerHTML="";

  const my = products.filter(p=>p.merchantShop===merchantName);
  if(my.length===0){
    box.innerHTML=`<div class="empty">No product published yet</div>`;
    return;
  }

  my.forEach(p=>{
    box.innerHTML+=`
      <div class="card">
        <img src="${p.images[0]}">
        <div class="card-body">
          <b>${p.name}</b>
          <div class="price">‚Çπ${p.price}</div>
          <button class="btn delete" onclick="deleteProduct(${p.id})">
            Delete Product
          </button>
        </div>
      </div>`;
  });
}

/* DELETE PRODUCT */
function deleteProduct(id){
  if(!confirm("Delete this product?")) return;
  products = products.filter(p=>p.id!==id);
  localStorage.setItem("products",JSON.stringify(products));
  renderProducts();
}

/* ===== MY ORDERS ===== */
function renderOrders(){
  const box = orderList;
  box.innerHTML="";

  const myOrders = orders.filter(o=>o.merchant===merchantName);
  if(myOrders.length===0){
    box.innerHTML=`<div class="empty">No orders yet</div>`;
    return;
  }

  myOrders.forEach(o=>{
    box.innerHTML+=`
      <div class="order ${o.status==='Delivered'?'grey':''}">
        <b>${o.productName}</b><br>
        ‚Çπ${o.amount} | ${o.payment}<br>
        Status: ${o.status}<br>
        <small>${o.customer.address}</small>
      </div>`;
  });
}

/* INIT */
renderProducts();
renderOrders();
</script>

</body>
</html>
