<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ISI ‚Äì Merchant Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="css/style.css">
</head>

<body>

<!-- ================= HEADER ================= -->
<header style="display:flex;align-items:center;justify-content:space-between;
padding:12px;background:#2874f0;color:white">

  <span onclick="history.back()" style="font-size:22px;cursor:pointer">‚¨ÖÔ∏è</span>
  <b>Merchant Dashboard</b>
  <span onclick="location.href='index.html'" style="font-size:22px;cursor:pointer">üè†</span>

</header>

<!-- ================= DASHBOARD ================= -->
<div class="container">

  <!-- MERCHANT INFO -->
  <div class="card">
    <h3 id="shopTitle"></h3>
    <button onclick="goPublish()">+ Publish New Product</button>
    <button onclick="goOrders()" style="margin-top:8px;background:#4caf50">
      View Orders
    </button>
  </div>

  <!-- PRODUCT LIST -->
  <div class="card">
    <h3>My Products</h3>
    <div id="productList"></div>
  </div>

</div>

<!-- ================= SCRIPT ================= -->
<script>
const merchant = JSON.parse(localStorage.getItem("merchant"));
const products = JSON.parse(localStorage.getItem("products")) || [];
const listBox = document.getElementById("productList");

if(!merchant){
  alert("Merchant not logged in");
  location.href = "merchant.html";
}

document.getElementById("shopTitle").innerText =
  "Shop: " + merchant.shopName;

/* RENDER PRODUCTS */
function renderProducts(){
  listBox.innerHTML = "";

  const myProducts = products.filter(
    p => p.merchant === merchant.shopName
  );

  if(myProducts.length === 0){
    listBox.innerHTML = "<p>No products published yet.</p>";
    return;
  }

  myProducts.forEach((p, index) => {
    listBox.innerHTML += `
      <div style="border-bottom:1px solid #eee;padding:10px 0">
        <b>${p.name}</b><br>

        <small>${p.desc}</small><br><br>

        <img src="${p.images[0]}" style="width:60px;height:60px;object-fit:cover;border-radius:6px">
        <img src="${p.images[1]}" style="width:60px;height:60px;object-fit:cover;border-radius:6px;margin-left:5px"><br><br>

        <b>‚Çπ${p.price}</b>
        <del style="color:#888">‚Çπ${p.mrp}</del>
        <span style="color:green">${p.discount}% OFF</span><br><br>

        <button onclick="deleteProduct(${p.id})"
          style="background:#ff3b3b;color:white">
          Delete Product
        </button>
      </div>
    `;
  });
}

/* DELETE PRODUCT */
function deleteProduct(id){
  if(!confirm("Are you sure you want to delete this product?")) return;

  const updated = products.filter(p => p.id !== id);
  localStorage.setItem("products", JSON.stringify(updated));
  location.reload();
}

/* NAVIGATION */
function goPublish(){
  location.href = "publish-product.html";
}
function goOrders(){
  location.href = "merchant-orders.html";
}

renderProducts();
</script>

</body>
</html>
