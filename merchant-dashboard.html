<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Merchant Dashboard – ISI</title>

<style>
*{box-sizing:border-box;font-family:Arial,Helvetica,sans-serif}
body{margin:0;background:#f5f6f8}

/* HEADER */
header{
  background:#2874f0;color:#fff;
  padding:12px;
  display:flex;align-items:center;justify-content:space-between;
}
header span{font-size:20px;cursor:pointer}

/* TABS */
.tabs{
  display:flex;
  background:#fff;
}
.tab{
  flex:1;
  padding:12px;
  text-align:center;
  cursor:pointer;
  border-bottom:3px solid transparent;
}
.tab.active{
  border-color:#2874f0;
  font-weight:bold;
}

/* CONTENT */
.container{padding:12px}

/* CARD */
.card{
  background:#fff;
  border-radius:12px;
  padding:12px;
  margin-bottom:12px;
  box-shadow:0 2px 6px rgba(0,0,0,0.1);
}

/* PRODUCT */
.product{
  border:1px solid #ddd;
  border-radius:10px;
  padding:10px;
  margin-bottom:10px;
}
.product img{
  width:100%;
  max-height:160px;
  object-fit:cover;
  border-radius:8px;
}

/* ORDER */
.order{
  border:1px solid #ddd;
  border-radius:10px;
  padding:10px;
  margin-bottom:10px;
}
.order.grey{
  background:#eee;
  opacity:0.7;
}

/* BUTTON */
button{
  width:100%;
  padding:10px;
  margin-top:8px;
  border:none;
  border-radius:8px;
  cursor:pointer;
}
.del{background:#e53935;color:#fff}
.pub{background:#2874f0;color:#fff}
</style>
</head>

<body>

<header>
  <span onclick="history.back()">←</span>
  <b>Merchant Dashboard</b>
  <span onclick="location.href='publish-product.html'">➕</span>
</header>

<div class="tabs">
  <div class="tab active" onclick="showTab('products')">My Products</div>
  <div class="tab" onclick="showTab('orders')">My Orders</div>
</div>

<div class="container">

  <!-- MY PRODUCTS -->
  <div id="productsTab">
    <div id="productList"></div>
  </div>

  <!-- MY ORDERS -->
  <div id="ordersTab" style="display:none">
    <div id="orderList"></div>
  </div>

</div>

<script>
/* LOGIN CHECK */
const merchantShop = localStorage.getItem("merchantShop");
if(!merchantShop){
  alert("Merchant not logged in");
  location.href="merchant-login.html";
}

/* DATA */
let products = JSON.parse(localStorage.getItem("products")) || [];
let orders = JSON.parse(localStorage.getItem("orders")) || [];

/* TAB SWITCH */
function showTab(tab){
  document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
  if(tab==="products"){
    productsTab.style.display="block";
    ordersTab.style.display="none";
    document.querySelectorAll(".tab")[0].classList.add("active");
  }else{
    productsTab.style.display="none";
    ordersTab.style.display="block";
    document.querySelectorAll(".tab")[1].classList.add("active");
  }
}

/* MY PRODUCTS */
function renderProducts(){
  const box=document.getElementById("productList");
  box.innerHTML="";
  const mine=products.filter(p=>p.merchantShop===merchantShop);

  if(mine.length===0){
    box.innerHTML="<p>No products published yet</p>";
    return;
  }

  mine.forEach(p=>{
    const d=document.createElement("div");
    d.className="product";
    d.innerHTML=`
      <img src="${p.images[0]}">
      <b>${p.name}</b><br>
      ₹${p.price} <del>₹${p.mrp}</del> (${p.discount}% OFF)
      <button class="del" onclick="deleteProduct(${p.id})">Delete Product</button>
    `;
    box.appendChild(d);
  });
}

/* DELETE PRODUCT */
function deleteProduct(id){
  if(!confirm("Delete this product?"))return;
  products=products.filter(p=>p.id!==id);
  localStorage.setItem("products",JSON.stringify(products));
  renderProducts();
}

/* MY ORDERS */
function renderOrders(){
  const box=document.getElementById("orderList");
  box.innerHTML="";
  const mine=orders.filter(o=>o.cart.some(i=>i.merchantShop===merchantShop));

  if(mine.length===0){
    box.innerHTML="<p>No orders yet</p>";
    return;
  }

  mine.forEach(o=>{
    const d=document.createElement("div");
    d.className="order"+(o.status==="Confirmed"?" grey":"");
    d.innerHTML=`
      <b>Order ID:</b> ${o.id}<br>
      <b>Total:</b> ₹${o.total}<br>
      <b>Payment:</b> ${o.payment}<br>
      <b>Customer:</b> ${o.address.name}<br>
      <b>Address:</b> ${o.address.address}<br>
      <b>Status:</b> ${o.status}
    `;
    box.appendChild(d);
  });
}

/* INIT */
renderProducts();
renderOrders();
</script>

</body>
</html>
