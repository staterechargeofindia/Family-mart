<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Merchant Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:Arial,Helvetica,sans-serif;
  background:#f1f3f6;
}
header{
  background:#2874f0;
  color:#fff;
  padding:12px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
header b{font-size:18px}
.container{padding:12px}

.section{
  background:#fff;
  border-radius:14px;
  padding:12px;
  margin-bottom:15px;
}

.product-card, .order-card{
  border:1px solid #eee;
  border-radius:12px;
  padding:10px;
  margin-bottom:10px;
}
.product-card img{
  width:100%;
  height:140px;
  object-fit:cover;
  border-radius:10px;
}
.btn{
  padding:8px 12px;
  background:#2874f0;
  color:#fff;
  border:none;
  border-radius:8px;
  cursor:pointer;
  margin-top:6px;
}
.btn.red{background:#e53935}
.btn.grey{background:#999}
small{color:#666}
hr{border:none;border-top:1px solid #eee;margin:8px 0}
</style>
</head>

<body>

<header>
  <span onclick="location.href='index.html'" style="cursor:pointer">üè†</span>
  <b>Merchant Dashboard</b>
  <span onclick="logout()" style="cursor:pointer">üö™</span>
</header>

<div class="container">

<!-- ===== MERCHANT INFO ===== -->
<div class="section">
  <b>Shop:</b> <span id="shopName"></span><br>
  <button class="btn" onclick="location.href='publish-product.html'">
    ‚ûï Publish New Product
  </button>
</div>

<!-- ===== MY PRODUCTS ===== -->
<div class="section">
  <h3>My Products</h3>
  <div id="myProducts"></div>
</div>

<!-- ===== MY ORDERS ===== -->
<div class="section">
  <h3>My Orders</h3>
  <div id="myOrders"></div>
</div>

</div>

<script>
/* ===== LOGIN CHECK ===== */
const merchant = localStorage.getItem("merchantName");
if(!merchant){
  location.href="merchant-login.html";
}
document.getElementById("shopName").innerText = merchant;

/* ===== LOAD DATA ===== */
let products = JSON.parse(localStorage.getItem("products")) || [];
let orders   = JSON.parse(localStorage.getItem("orders")) || [];

/* ===== MY PRODUCTS ===== */
const myProductsBox = document.getElementById("myProducts");
const myProducts = products.filter(p => p.merchant === merchant);

if(myProducts.length === 0){
  myProductsBox.innerHTML = "<p>No products published yet.</p>";
}

myProducts.forEach(p=>{
  myProductsBox.innerHTML += `
    <div class="product-card">
      <img src="${p.images[0]}">
      <b>${p.name}</b><br>
      ‚Çπ${p.price} <small>(MRP ‚Çπ${p.mrp})</small><br>
      <small>Category: ${p.category}</small><br>
      <button class="btn red" onclick="deleteProduct(${p.id})">
        üóë Delete
      </button>
    </div>
  `;
});

/* ===== DELETE PRODUCT ===== */
function deleteProduct(id){
  if(!confirm("Delete this product?")) return;
  products = products.filter(p => p.id !== id);
  localStorage.setItem("products", JSON.stringify(products));
  alert("Product deleted");
  location.reload();
}

/* ===== MY ORDERS ===== */
const myOrdersBox = document.getElementById("myOrders");
const myOrders = orders.filter(o => o.merchant === merchant);

if(myOrders.length === 0){
  myOrdersBox.innerHTML = "<p>No orders yet.</p>";
}

myOrders.forEach(o=>{
  myOrdersBox.innerHTML += `
    <div class="order-card" style="${o.status==='Delivered'?'opacity:0.6':''}">
      <b>Order ID:</b> ${o.id}<br>
      <b>Product:</b> ${o.productName}<br>
      <b>Amount:</b> ‚Çπ${o.amount}<br>
      <b>Payment:</b> ${o.payment}<br>
      <b>Status:</b> ${o.status}<br>
      <hr>
      <b>Customer:</b><br>
      ${o.customer.name}<br>
      ${o.customer.mobile}<br>
      ${o.customer.address}
    </div>
  `;
});

/* ===== LOGOUT ===== */
function logout(){
  localStorage.removeItem("merchantName");
  location.href="merchant-login.html";
}
</script>

</body>
</html>
